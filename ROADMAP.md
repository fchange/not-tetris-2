**物理俄罗斯方块开发路线图**

1.  **界面搭建与基础设置:**
    *   创建 `index.html` 文件。
    *   在 HTML 中添加一个 `<canvas>` 元素用于游戏渲染。
    *   引入 `Matter.js` 库文件。
    *   初始化 `Matter.js` 引擎 (`Engine`)、渲染器 (`Render`) 和运行器 (`Runner`)。
    *   设置基本的渲染选项（如画布大小、背景色）。

2.  **实现自由落体的俄罗斯方块:**
    *   在物理世界中设置重力 (`engine.world.gravity`)。
    *   定义几种不同的俄罗斯方块形状（例如 I, L, T, S, Z, O, J），可以使用 `Matter.Bodies` 或 `Matter.Composite`。
    *   编写一个函数，用于在画布顶部的特定位置随机生成一个方块并添加到物理世界 (`Matter.World.add`)。让它能自然下落。

3.  **添加边界与碰撞:**
    *   创建静态 (static) 的物理实体作为游戏的边界：地面、左右墙壁、顶部边界 (`Matter.Bodies.rectangle` 并设置 `isStatic: true`)。
    *   将这些边界添加到物理世界中，防止方块掉出游戏区域。
    *   (Matter.js 会自动处理方块之间以及方块与边界的碰撞)。

4.  **加入控制:**
    *   添加键盘事件监听器 (`document.addEventListener('keydown', ...)`).
    *   当按下左方向键时，对当前活动的方块施加一个逆时针的扭矩 (`Matter.Body.applyForce` 或 `Matter.Body.setAngularVelocity`)。
    *   当按下右方向键时，施加顺时针扭矩。
    *   (可选) 实现按下下方向键加速下落的功能。
    *   确保同一时间只有一个方块是玩家可控的（标记当前活动方块）。

5.  **实现水平检测带与物理消除:**
    *   **静止检测:** 实现一个机制来判断场景中所有的动态方块是否都已停止运动 (`isSleeping`)。这通常在 `Matter.Events.on(engine, 'afterUpdate', ...)` 中检查。
    *   **区域划分:** 在代码中定义好 `N` 个水平检测带的垂直范围（y坐标）。
    *   **面积计算:** 当所有方块静止后，遍历每个检测带：
        *   计算该检测带内所有物理实体占据的总面积。这可能需要检查每个物体的顶点 (`body.vertices`) 是否在区域内，或者使用更精确的几何库/算法计算相交面积。
        *   将计算出的总面积与检测带的总面积（`区域宽度 * 检测带高度`）比较。
    *   **物理切割:** 如果某个检测带的占用率达到 90%：
        *   找出所有与该检测带相交的物体。
        *   对于每个相交物体，执行"切割"：
            *   从物理世界移除 (`Matter.World.remove`) 原物体。
            *   根据切割线计算出上方和下方两部分（或多部分）的新顶点。
            *   使用新顶点创建新的、更小的物理实体 (`Matter.Bodies.fromVertices`)，并继承或设置合适的物理属性（质量、摩擦力等）。
            *   将新实体添加回物理世界。

6.  **得分系统:**
    *   设置基础得分值。
    *   在每次成功消除检测带后，根据 `基础分 * 当前难度系数` 增加分数。
    *   实现连击计数器：如果在一次"静止-检测-消除"周期中清除了多个检测带，根据斐波那契数列（1, 1, 2, 3, 5...）应用得分倍率。
    *   实现风险奖励：根据被消除方块的平均高度给予额外的分数加成。
    *   在界面上添加显示分数的元素，并实时更新。

7.  **难度系统与游戏结束:**
    *   引入难度系数变量，让它随游戏时间或放置的方块数量缓慢增加。
    *   将方块的初始下落速度或生成间隔与难度系数关联起来，难度越高，方块越快。
    *   实现游戏结束逻辑：通过碰撞事件 (`Matter.Events.on(engine, 'collisionStart', ...)` ) 或在 `afterUpdate` 中检查是否有任何方块接触到了顶部边界。
    *   游戏结束后，停止生成新的方块，并显示最终得分或"Game Over"信息。

8.  **高级特性 (可选):**
    *   **环境干扰:** 定时或随机改变 `engine.world.gravity.y` 的值，或给所有物体施加一个小的随机力模拟震动。
    *   **碎片效果:** 在执行物理切割时，额外生成一些非常小的、短生命周期的粒子效果。
    *   **粘滞流体:** (较复杂) 模拟一片区域的流体效果，对方块施加与速度相关的阻力。 